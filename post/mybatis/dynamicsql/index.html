<!DOCTYPE html>
<html lang="en"><head>
    <title>首页</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://fyzn12.github.io/favicon.ico">
    <link rel="canonical" href="https://fyzn12.github.io">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://fyzn12.github.io">首页</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/post/">
                                    
                                    <span>All posts</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>mybatis之动态SQL - Tue, Oct 8, 2019</h1>
    </div>
    <p class="lead">动态SQL语句总结</p>
    

<h1 id="动态sql语句总结">动态SQL语句总结</h1>

<h2 id="主要内容">主要内容</h2>

<ul>
<li>if元素<br /></li>
<li>choose、when、otherwise元素</li>
<li>trim、where、set元素</li>
<li>foreach元素</li>
</ul>

<hr />

<h2 id="if-元素">if 元素</h2>

<p>下面先看一个例子</p>

<pre><code>    &lt;select id=&quot;selectUserById&quot; resultType=&quot;MyUser&quot; parameterType=&quot;MyUser&quot;&gt;
        select * from user where 1=1
        &lt;if test =&quot;name !=null and name !=''&quot;&gt;
            and name like concat('%',#{name},'%')
        &lt;/if&gt;
        &lt;if test = &quot;sex !=null and sex !=''&quot;&gt;
            and sex = #{sex}
        &lt;/if&gt;
    &lt;/select&gt;  
</code></pre>

<p>在上面的例子中，运用的是sql语句的拼接，在这里需要注意的是有如下几点：</p>

<pre><code>    1. resultType与resultMap不能同时使用  
    2. #{xxx}与${vlaue}的使用看上一篇博客  
    3. if的判断条件的test里面的参数目前我知道有三种声明方式如下：  

    1）对象作为参数，则test里面的参数为对象的属性  
    2)@Param声明的参数  
    3)map方式键值对  
</code></pre>

<hr />

<h2 id="choose-when-otherwise元素">choose、when 、otherwise元素</h2>

<p>有些时候不想用到所以的条件语句，而只想从中选择一二，针对这种情况，Mybatis提供了<code>&lt;choose&gt;</code>元素，如下例子。</p>

<pre><code>    &lt;select id = &quot;selectUserBychoose&quot; resultType=&quot;MyUser&quot; parameterType=&quot;MyUser&quot;&gt;
        select * from user where 1=1
        &lt;choose&gt;
            &lt;when test=&quot;name !=null and name !=''&quot;&gt;
                and name like concat('%',#{name},'%')
            &lt;/when&gt;
            &lt;when test=&quot;sex != null and sex !='' &quot;
                and sex=#{sex}
            &lt;/when&gt;
            &lt;otherwise&gt;
                and id&gt;10
            &lt;/otherwise&gt;
        &lt;/choose&gt;  
</code></pre>

<p>上面sql语句的含义是当满足test里面的其中之一时，执行when子句，两者都不满足时执行otherwise子句，这样做就可以实现if元素没法实现的一些选择功能。</p>

<hr />

<h2 id="trim-where-set元素">trim、where、set元素</h2>

<p>trim 的主要功能是可以在自己包含的内容上加上某些前缀，也可以在后面加上某些后缀，与之对应的属性是prefix和suffix；可以把包含内容的首部某些内容覆盖，及忽略，也可以把尾部的某些内容覆盖，对应的属性是prefixOverrides和suffixOverrides。正因为<code>&lt;trim&gt;</code>元素有这样的功能，所以也可以非常简单利用<code>&lt;trim&gt;</code>来代替<code>&lt;where&gt;</code>元素功能。代码如下：</p>

<p>trim应用</p>

<pre><code>    &lt;select id=&quot;selectByTrim&quot; resultType=&quot;MyUser&quot; parameterType=&quot;MyUser&quot;&gt;
        select * from user
        &lt;trim prefix=&quot;where&quot; prefixOverrides=&quot;and | or&quot;&gt;
            &lt;if test=&quot;name !=null and name !=''&quot;&gt;
                and name like concat('%',#{name},'%')
            &lt;/if&gt;
            &lt;if test=&quot;sex !=null and sex !=''&quot;&gt;
                and sex=#{sex}
            &lt;/if&gt;
        &lt;/trim&gt;
    &lt;/select&gt;  

    &lt;!-- sql动态中的trim标签
    prefix&quot;在前面进行添加&quot;
    prefixOverreds=&quot;在前面进行去掉&quot;
    suffix=&quot;在后面进行添加&quot;
    suffixOverreds=&quot;在后面进行去掉&quot;
    重点：执行的重点，先去除，在添加
    使用trim 会在prefix设置的值后面添加空格  在使用trim进行模糊查询不可取
    --&gt;

    &lt;update id=&quot;upid&quot; parameterType=&quot;Teacher&quot;&gt;   
        update Teacher
        &lt;trim prefix=&quot;set&quot; suffixOverreds&quot;,&quot;&gt;
            name=#{name},age=#{age}
        &lt;/trim&gt;
        where id=#{id}
    &lt;/update&gt;
</code></pre>

<p>where子句的应用</p>

<pre><code>&lt;select id=&quot;selectByWhere&quot; resultType=&quot;MyUser&quot; parameType=&quot;MyUser&quot;&gt;
    select * from user
    &lt;where&gt;
        &lt;if test=&quot;name !=null and name !=''&quot;&gt;
            and name like concat('%',#{name},'%')
        &lt;/if&gt;
        &lt;if test=&quot;sex !=null and sex !=''&quot;&gt;
            and sex=#{sex}
        &lt;/if&gt;
    &lt;/where&gt;
&lt;/select&gt;  
</code></pre>

<p>set元素的应用：</p>

<pre><code>&lt;select id=&quot;selectBySet&quot; resultType=&quot;MyUser&quot; parameType=&quot;MyUser&quot;&gt;
    update user
    &lt;set&gt;
        &lt;if test=&quot;name !=null and name !=''&quot;
            name like concat('%',#{name},'%')
        &lt;/if&gt;
        &lt;if test=&quot;sex !=null and sex !=''&quot;
            sex like concat('%',#{sex},'%')
        &lt;/if&gt;
    &lt;/set&gt;
    where id=#{id}
&lt;/select&gt;
</code></pre>

<p>set 子句会在update的sql语句中用到，对应的值千万别忘了where限定。</p>

<p>foreach元素的应用:<br />
        foreach主要用在构建in条件中，它可以在SQL语句中迭代一个集合，<code>&lt;foreach&gt;</code>元素的属性主要有item、index、collection、open、separator、close。item表示集合中每个元素进行迭代时的别名，index指定一个名字，用于表示在迭代过程中每次迭代到的位置，open表示该语句以什么开始，separator表示在每次进行迭代之间以什么符号进行分隔符，close表示以什么结束。在使用<code>&lt;foreach&gt;</code>元素时最关键，最容易出错的是collection属性，该属性是必选的，但在不同情况下值不同，有以下几种情况：</p>

<pre><code>    * 如果传入的是单参数且参数类型是一个List，collection属性值为list  
    * 如果传入的参数是单参数且参数类型是一个arry数组，collection值为arry
    * 如果传入的参数是多个，需要把她们封装成一个Map，当然单参数也可以封装成Map。map的key值参数名，collection属性值是传入的List或者arry对象在封装的Map中的key  
</code></pre>

<p>具体例子如下：</p>

<pre><code>&lt;select id=&quot;selectByForeach&quot; resultType=&quot;MyUser&quot; parameterType=&quot;List&quot;&gt;
    select *from user
    &lt;foreach item=&quot;item&quot; index='index' collection='list' open=&quot;(&quot;separator='',&quot;close=&quot;)&quot;&gt;
        #{item}
    &lt;/foreach&gt;
&lt;/select&gt; 
&lt;!-- 
    foreach的作用：
        1.查询中的使用 多值查询 in
        2.批量添加
--&gt;
&lt;!-- in的使用 --&gt;
&lt;select id=&quot;selectByForeach&quot; resultType=&quot;MyUser&quot; parameterType=&quot;List&quot;&gt;
    select * from user where age in
        &lt;foreach collection=&quot;list&quot; item=&quot;age&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt;
            #{age}
        &lt;/foreach&gt;
&lt;/select&gt;

&lt;!-- 使用foreach与trim联合使用 批量添加--&gt;
&lt;!-- sql的声明字段 --&gt;
&lt;sql id=&quot;fileName&quot;&gt;
    (id,name,age,sex)
&lt;/sql&gt;
&lt;insert id=&quot;insertByForeach&quot; parameterType=&quot;list&quot;&gt;
    insert into teacher &lt;include refid=&quot;fileName&quot;/&gt;  values
        &lt;trim suffixOverreds=&quot;,&quot;&gt;&lt;!-- 去掉最后一个&quot;,&quot; --&gt;
            &lt;foreach collection=&quot;list&quot; item=&quot;user&quot;&gt;
                (id,#{user.name},#{user.age},#{user.sex}),
            &lt;/foreach&gt;
        &lt;/trim&gt;
&lt;/insert&gt;
</code></pre>

<hr />

<h2 id="bind元素">bind元素</h2>

<p>在进行模糊查询时，如果使用&rdquo;${}&ldquo;拼接字符串，则无法防止SQL注入问题；bind使用可以一定程度上避免这个问题。代码演示如下：</p>

<pre><code>    &lt;select id=&quot;selectByBind&quot; resultType=&quot;MyUser&quot; parameType=&quot;List&quot;&gt;
        &lt;bind name =&quot;paran_uname&quot; vlaue = &quot;'%'+uname+'%' &quot;/&gt;
        select * from user
            where name like #{paran_uname}
    &lt;/select&gt;

    &lt;!-- 
        sql动态中的bind标签对变量或者查询的条件进行重新定义,模糊查询中trim的prefix和suffix使用后会在后面添加空格，显然不适合模糊查询。  
    --&gt;
    &lt;select id=&quot;selectBind&quot; parameterType=&quot;&quot;Teacher resultType=&quot;Teacher&quot;&gt;
        &lt;bind name=&quot;name&quot; vlaue=&quot;'%'+name+'%'&quot;/&gt;
        select * from teacher where name like #{name}
    &lt;/select&gt;
</code></pre>

    <h4><a href="https://fyzn12.github.io">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>

    <a href="https://fyzn12.github.io">fyzn12</a> | 

&copy; 
<a href="https://fyzn12.github.io" target="_blank">
    fyzn12
</a>
<span id="thisyear">2020</span>

    | @


        | Built on <a href="//gohugo.io" target="_blank">Hugo</a>
</p>
    <p class="text-center">
        <a href="https://facebook.com">Facebook</a> 
        <a href="https://twitter.com">Twitter</a> 
        <a href="https://linkedin.com">Linkedin</a> 
        <a href="https://github.com">GitHub</a> 
        <a href="https://gitlab.com">GitLab</a>
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: false ,
        onePass: false , 
        speedFactor: 1 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
