<!DOCTYPE html>
<html lang="en">

<head>
    
<meta charset="utf-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>SpringBoot整合Redis使用注解实现同步缓存 - fyzn12的博客</title>

<meta name="description" content="1 SpringBoot整合Redis的环境配置 1.1 添加依赖 &amp;lt;properties&amp;gt; &amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt; &amp;lt;druid.version&amp;gt;1.1.9&amp;lt;/druid.version&amp;gt; &amp;lt;!-- mybatis的版本 --&amp;gt; &amp;lt;mybatis.version&amp;gt;3.4.6&amp;lt;/mybatis.version&amp;gt; &amp;lt;/properties&amp;gt; &amp;lt;dependencies&amp;gt; &amp;lt;!-- 配置web启动器--&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;!-- 配置mybatis--&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;8.0.15&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.mybatis.spring.boot&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;mybatis-spring-boot-starter&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.2.0&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;!-- 配置数据库连接池 --&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;com.alibaba&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;druid&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;${druid.version}&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt; &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;spring-boot-starter-test&amp;lt;/artifactId&amp;gt; &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt; &amp;lt;exclusions&amp;gt; &amp;lt;exclusion&amp;gt; &amp;lt;groupId&amp;gt;org.junit.vintage&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;junit-vintage-engine&amp;lt;/artifactId&amp;gt; &amp;lt;/exclusion&amp;gt; &amp;lt;/exclusions&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;junit&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;junit&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;4.12&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt; &amp;lt;exclusions&amp;gt; &amp;lt;!--不依赖Redis的异步客户端lettuce--&amp;gt; &amp;lt;exclusion&amp;gt; &amp;lt;groupId&amp;gt;io.lettuce&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;lettuce-core&amp;lt;/artifactId&amp;gt; &amp;lt;/exclusion&amp;gt; &amp;lt;/exclusions&amp;gt; &amp;lt;/dependency&amp;gt; &amp;lt;!" /><meta name="keywords"
  content="fyzn12, java, 网络安全, 红蓝攻防, 渗透测试, bypass, waf, 注入, 黑客, chabug" />


<link rel="stylesheet" href="https://fyzn12.github.io/css/main.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.12/src/css/lightgallery.css">



<meta property="og:title" content="SpringBoot整合Redis使用注解实现同步缓存" />
<meta property="og:description" content="1 SpringBoot整合Redis的环境配置 1.1 添加依赖 &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;druid.version&gt;1.1.9&lt;/druid.version&gt; &lt;!-- mybatis的版本 --&gt; &lt;mybatis.version&gt;3.4.6&lt;/mybatis.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- 配置web启动器--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 配置mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.15&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 配置数据库连接池 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;exclusions&gt; &lt;!--不依赖Redis的异步客户端lettuce--&gt; &lt;exclusion&gt; &lt;groupId&gt;io.lettuce&lt;/groupId&gt; &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fyzn12.github.io/post/springboot%E6%95%B4%E5%90%88redis%E5%AE%9E%E7%8E%B0%E5%90%8C%E6%AD%A5%E7%BC%93%E5%AD%98/" />
<meta property="article:published_time" content="2020-09-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-08T00:00:00+00:00" />
<meta itemprop="name" content="SpringBoot整合Redis使用注解实现同步缓存">
<meta itemprop="description" content="1 SpringBoot整合Redis的环境配置 1.1 添加依赖 &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;druid.version&gt;1.1.9&lt;/druid.version&gt; &lt;!-- mybatis的版本 --&gt; &lt;mybatis.version&gt;3.4.6&lt;/mybatis.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- 配置web启动器--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 配置mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.15&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 配置数据库连接池 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;exclusions&gt; &lt;!--不依赖Redis的异步客户端lettuce--&gt; &lt;exclusion&gt; &lt;groupId&gt;io.lettuce&lt;/groupId&gt; &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!">


<meta itemprop="datePublished" content="2020-09-08T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-09-08T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="466">



<meta itemprop="keywords" content="redis," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpringBoot整合Redis使用注解实现同步缓存"/>
<meta name="twitter:description" content="1 SpringBoot整合Redis的环境配置 1.1 添加依赖 &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;druid.version&gt;1.1.9&lt;/druid.version&gt; &lt;!-- mybatis的版本 --&gt; &lt;mybatis.version&gt;3.4.6&lt;/mybatis.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- 配置web启动器--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 配置mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.15&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 配置数据库连接池 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;exclusions&gt; &lt;!--不依赖Redis的异步客户端lettuce--&gt; &lt;exclusion&gt; &lt;groupId&gt;io.lettuce&lt;/groupId&gt; &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
</head>

<body>
    <div class="header-placeholder"></div>
    
    <header class="header">
        <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    
    <a class="site-title" href="https://fyzn12.github.io/">fyzn12</a>
    
    <nav class="site-nav">
        <a class="page-link" href="/">Home</a><a class="page-link" href="/post/">Category</a><a class="page-link" href="/about">About</a>
    </nav>
</div>

    </header>

    
    <div class="page-content">
        <div class="wrapper">
            
            <div class="col-main">
                <div class="post">
    
    <header class="post-header">
        <h1 class="post-title">SpringBoot整合Redis使用注解实现同步缓存</h1>
        <p class="post-meta">Sep 08, 2020</p>
    </header>
    <article class="post-content">
        
        
        
        
        
        
        

<h1 id="1-springboot整合redis的环境配置">1 SpringBoot整合Redis的环境配置</h1>

<h2 id="1-1-添加依赖">1.1 添加依赖</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
        <span class="nt">&lt;druid.version&gt;</span>1.1.9<span class="nt">&lt;/druid.version&gt;</span>
        <span class="c">&lt;!-- mybatis的版本 --&gt;</span>
        <span class="nt">&lt;mybatis.version&gt;</span>3.4.6<span class="nt">&lt;/mybatis.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>

        <span class="c">&lt;!-- 配置web启动器--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- 配置mybatis--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>8.0.15<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- 配置数据库连接池 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${druid.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>org.junit.vintage<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>junit-vintage-engine<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span> <span class="c">&lt;!--不依赖Redis的异步客户端lettuce--&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>io.lettuce<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>lettuce-core<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!--引入Redis的客户端驱动jedis--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>redis.clients<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jedis<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!--SpringBoot缓存支持启动器--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-cache<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!--Ehcache坐标--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>net.sf.ehcache<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>ehcache<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;/dependencies&gt;</span>  </code></pre></div><div class="highlight"><pre class="chroma">    这样我们就引入了Spring对Redis的starter，只是在默认的情况下，spring-boot-starter-data-redis（版本2.x）  
    会依赖Lettuce的Redis客户端驱动，而在一般的项目中，我们会使用Jedis，所以在代码中使用了＜exclusions＞  
    元素将其依赖排除了，与此同时引入了Jedis的依赖，这样就可以使用Jedis进行编程了。  </pre></div>
<h2 id="1-2-配置application-properties文件">1.2 配置application.properties文件</h2>
<div class="highlight"><pre class="chroma"><code class="language-yml" data-lang="yml"><span class="c">################# 配置数据库连接参数*************************************************</span><span class="w">
</span><span class="w"></span>spring.datasource.driverClassName<span class="w"> </span>=com.mysql.cj.jdbc.Driver<span class="w">
</span><span class="w"></span>spring.datasource.url=jdbc<span class="p">:</span>mysql<span class="p">:</span>//localhost<span class="p">:</span><span class="m">3306</span>/test<span class="p">?</span>serverTimezone=GMT%2B8<span class="w">
</span><span class="w"></span>spring.datasource.username=root<span class="w">
</span><span class="w"></span>spring.datasource.password=<span class="m">123456</span><span class="w">
</span><span class="w"></span>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource<span class="w">
</span><span class="w"></span><span class="c">###### 指定mapper文件的位置</span><span class="w">
</span><span class="w"></span>mybatis.mapper-locations=classpath<span class="p">:</span>mapper/<span class="cp">*.xml</span><span class="w">
</span><span class="w"></span><span class="c">## 设置视图层的别名，类似于在spring项目中的mybatis-config.xml文件中配置&lt;typeAliases&gt;</span><span class="w">
</span><span class="w"></span>mybatis.type-aliases-package=com.fyzn12.pojo<span class="w">
</span><span class="w"></span><span class="c">################## 更改springboot内置tomcat的参数**********************</span><span class="w">
</span><span class="w"></span><span class="c"># 连接池中的最大空闲连接</span><span class="w">
</span><span class="w"></span>spring.datasource.tomcat.max-idle=<span class="m">10</span><span class="w">
</span><span class="w"></span><span class="c"># 连接池最大连接数（使用负值表示没有限制）</span><span class="w">
</span><span class="w"></span>spring.datasource.tomcat.max-active=<span class="m">50</span><span class="w">
</span><span class="w"></span><span class="c"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span><span class="w">
</span><span class="w"></span>spring.datasource.tomcat.max-wait=<span class="m">10000</span><span class="w">
</span><span class="w"></span>spring.datasource.tomcat.initial-size=<span class="m">5</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">################### 设置默认的隔离级别为读已提交 ************************</span><span class="w">
</span><span class="w"></span>spring.datasource.tomcat.default-transaction-isolation=<span class="m">2</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">################### 配置redis****************************************************</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># 配置连接池属性</span><span class="w">
</span><span class="w"></span><span class="c"># Redis数据库索引（默认为0）</span><span class="w">
</span><span class="w"></span>spring.redis.database=<span class="m">0</span><span class="w">
</span><span class="w"></span><span class="c"># Redis服务器地址</span><span class="w">
</span><span class="w"></span>spring.redis.host=<span class="m">127.0.0.1</span><span class="w">
</span><span class="w"></span><span class="c"># Redis服务器连接端口</span><span class="w">
</span><span class="w"></span>spring.redis.port=<span class="m">6379</span><span class="w">
</span><span class="w"></span><span class="c"># Redis服务器连接密码（默认为空）</span><span class="w">
</span><span class="w"></span><span class="c">#spring.redis.password=</span><span class="w">
</span><span class="w"></span><span class="c"># 连接池最大连接数（使用负值表示没有限制）</span><span class="w">
</span><span class="w"></span>spring.redis.jedis.pool.max-active=<span class="m">5000</span><span class="w"> 
</span><span class="w"></span><span class="c"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span><span class="w">
</span><span class="w"></span>spring.redis.jedis.pool.max-wait=-<span class="m">1</span><span class="w">
</span><span class="w"></span><span class="c"># 连接池中的最大空闲连接</span><span class="w">
</span><span class="w"></span>spring.redis.jedis.pool.max-idle=<span class="m">8</span><span class="w">
</span><span class="w"></span><span class="c"># 连接池中的最小空闲连接</span><span class="w">
</span><span class="w"></span>spring.redis.jedis.pool.min-idle=<span class="m">0</span><span class="w">
</span><span class="w"></span><span class="c"># 连接超时时间（毫秒）</span><span class="w">
</span><span class="w"></span>spring.redis.timeout=<span class="m">1000</span><span class="w">
</span><span class="w"></span><span class="c">#spring-session 使用</span><span class="w">
</span><span class="w"></span>spring.session.store-type=none<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">################### 配置缓存管理  **********************************************</span><span class="w">
</span><span class="w"></span><span class="c"># 配置redis的缓存管理器</span><span class="w">
</span><span class="w"></span><span class="c"># spring.cache.type=redis配置的是缓存类型，Spring Boot会自动生成RedisCacheManager对象</span><span class="w">
</span><span class="w"></span>spring.cache.type=redis<span class="w">
</span><span class="w"></span><span class="c"># spring.cache.cache-names则是配置缓存名称，多个名称可以使用逗号分隔，以便于缓存注解的引用。</span><span class="w">
</span><span class="w"></span>spring.cache.cache-names=redisCache<span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">################### 配置日志 **************************************************</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c">#logging.level.root=DEBUG</span><span class="w">
</span><span class="w"></span><span class="c">#logging.level.org.springframework=DEBUG</span><span class="w">
</span><span class="w"></span><span class="c">#logging.level.org.mybatis=DEBUG</span></code></pre></div>
<h3 id="在上面配置文件中详细配置了redis的使用-这里注意-配置缓存管理-的配置">在上面配置文件中详细配置了redis的使用，这里注意“配置缓存管理”的配置</h3>

<h1 id="2-三个spring注解的讲解-cacheable-cacheevict-和-cacheput">2 三个Spring注解的讲解 @Cacheable 、 @CacheEvict 和 @CachePut</h1>

<h2 id="2-1-cacheable用于查询">2.1 @Cacheable用于查询</h2>

<ol>
<li><p>@Cacheable作用：把方法的返回值添加到Ehcache中做缓存Value属性：指定一个Ehcache配置文件中的缓存策略，如果么有给定value，name则表示使用默认的缓存策略。</p></li>

<li><p>在Spring中使用xml文件配置时采用如下配置</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  
<span class="nt">&lt;ehcache</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&#34;../config/ehcache.xsd&#34;</span><span class="nt">&gt;</span>

<span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">&#34;java.io.tmpdir&#34;</span><span class="nt">/&gt;</span>

<span class="c">&lt;!--defaultCache:echcache的默认缓存策略  --&gt;</span>
<span class="nt">&lt;defaultCache</span>
        <span class="na">maxElementsInMemory=</span><span class="s">&#34;10000&#34;</span>
        <span class="na">eternal=</span><span class="s">&#34;false&#34;</span>
        <span class="na">timeToIdleSeconds=</span><span class="s">&#34;120&#34;</span>
        <span class="na">timeToLiveSeconds=</span><span class="s">&#34;120&#34;</span>
        <span class="na">maxElementsOnDisk=</span><span class="s">&#34;10000000&#34;</span>
        <span class="na">diskExpiryThreadIntervalSeconds=</span><span class="s">&#34;120&#34;</span>
        <span class="na">memoryStoreEvictionPolicy=</span><span class="s">&#34;LRU&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;persistence</span> <span class="na">strategy=</span><span class="s">&#34;localTempSwap&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/defaultCache&gt;</span>
<span class="c">&lt;!-- 自定义缓存策略 --&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&#34;users&#34;</span>
        <span class="na">maxElementsInMemory=</span><span class="s">&#34;10000&#34;</span>
        <span class="na">eternal=</span><span class="s">&#34;false&#34;</span>
        <span class="na">timeToIdleSeconds=</span><span class="s">&#34;120&#34;</span>
        <span class="na">timeToLiveSeconds=</span><span class="s">&#34;120&#34;</span>
        <span class="na">maxElementsOnDisk=</span><span class="s">&#34;10000000&#34;</span>
        <span class="na">diskExpiryThreadIntervalSeconds=</span><span class="s">&#34;120&#34;</span>
        <span class="na">memoryStoreEvictionPolicy=</span><span class="s">&#34;LRU&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;persistence</span> <span class="na">strategy=</span><span class="s">&#34;localTempSwap&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/ehcache&gt;</span>
    </code></pre></div></li>

<li><p>使用方式</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">	<span class="nd">@Override</span>
	<span class="c1">//@Cacheable:对当前查询的对象做缓存处理
</span><span class="c1"></span>	<span class="nd">@Cacheable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;users&#34;</span><span class="p">)</span>
	<span class="kd">public</span> <span class="nf">Users</span> <span class="n">findUserById</span><span class="p">(</span><span class="n">Integer</span> <span class="nf">id</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">usersRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="p">}</span>    
	<span class="o">//</span><span class="n">其中value值为xml文件中配置的name的值</span></code></pre></div></li>

<li><p>在SpringBoot中使用</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * @Param: param
</span><span class="cm"> * @description:查询
</span><span class="cm"> * @Return
</span><span class="cm"> * @Cacheable注解的说明
</span><span class="cm"> *      value：该值为在application.properties文件中配置spring.cache.cache-names=redisCache指定的值 
</span><span class="cm"> *      key ：为该缓存取一个名字
</span><span class="cm">*/</span>
<span class="nd">@Override</span>
<span class="nd">@Cacheable</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;redisCache&#34;</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;key_user&#39;+#param.getParam()&#34;</span><span class="p">)</span>
<span class="nd">@Transactional</span><span class="p">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="n">Isolation</span><span class="p">.</span><span class="na">REPEATABLE_READ</span><span class="p">,</span> <span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="p">.</span><span class="na">REQUIRES_NEW</span><span class="p">,</span> <span class="n">rollbackFor</span> <span class="o">=</span> <span class="n">RuntimeException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="nf">Object</span> <span class="n">strategy</span><span class="p">(</span><span class="n">HandlerParam</span> <span class="nf">param</span><span class="p">)</span> <span class="kd">throws</span> <span class="nf">IOException</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;执行查询&#34;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">Integer</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//如果是全是数字组成的查询值，则认为是按照id进行查询，否则认为按照name查询
</span><span class="c1"></span>        <span class="n">Users20174046</span> <span class="nf">users20174046</span> <span class="o">=</span> <span class="n">users20174046Mapper</span><span class="p">.</span><span class="na">selectById</span><span class="p">((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">users20174046</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Users20174046</span><span class="o">&gt;</span> <span class="nf">list</span> <span class="o">=</span> <span class="n">users20174046Mapper</span><span class="p">.</span><span class="na">selectByName</span><span class="p">((</span><span class="n">String</span><span class="p">)</span> <span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
  </code></pre></div></li>
</ol>

<h2 id="2-2-cacheput-用于插入和修改">2.2 @CachePut 用于插入和修改</h2>

<ol>
<li><p>用于插入时用法</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> 
<span class="cm">/**
</span><span class="cm"> * @Param: param
</span><span class="cm"> * @description:插入
</span><span class="cm"> * @Return
</span><span class="cm"> * @CachePut注解的说明
</span><span class="cm"> *      value：该值为在application.properties文件中配置spring.cache.cache-names=redisCache指定的值
</span><span class="cm"> *      key ：为该缓存取一个名字
</span><span class="cm"> */</span>
<span class="nd">@Override</span>
<span class="nd">@CachePut</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;redisCache&#34;</span><span class="p">,</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;redis_user&#39;+#result.id&#34;</span><span class="p">)</span>
<span class="nd">@Transactional</span><span class="p">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="n">Isolation</span><span class="p">.</span><span class="na">REPEATABLE_READ</span><span class="p">,</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="p">.</span><span class="na">REQUIRES_NEW</span><span class="p">,</span><span class="n">rollbackFor</span> <span class="o">=</span> <span class="n">RuntimeException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="nf">Object</span> <span class="n">strategy</span><span class="p">(</span><span class="n">HandlerParam</span> <span class="nf">param</span><span class="p">)</span>  <span class="p">{</span>
    <span class="kt">int</span> <span class="nf">count</span> <span class="o">=</span> <span class="n">users20174046Mapper</span><span class="p">.</span><span class="na">insertUsers</span><span class="p">((</span><span class="n">Users20174046</span><span class="p">)</span> <span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">());</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>    
  
<span class="cm">/*
</span><span class="cm">
</span><span class="cm">在插入数据库前，对应的用户是没有id的，而这个id值会在插入数据库后由MyBatis的机制回填，  
</span><span class="cm">所以我们希望使用返回结果，这样使用＃result就代表返回的结果对象了，它是一个User对象，  
</span><span class="cm">所以＃result.id是取出它的属性id，这样就可以引用这个由数据库生成的id了。	
</span><span class="cm">*/</span>
  </code></pre></div></li>

<li><p>用于修改时的用法</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">  
<span class="cm">/**
</span><span class="cm"> * @Param: param
</span><span class="cm"> * @description:修改
</span><span class="cm"> * @Return
</span><span class="cm"> * @CachePut注解的说明
</span><span class="cm"> *      value：该值为在application.properties文件中配置spring.cache.cache-names=redisCache指定的值
</span><span class="cm"> *      key ：为该缓存取一个名字
</span><span class="cm"> *      condition:设置修改条件
</span><span class="cm"> */</span>
<span class="nd">@Override</span>
<span class="nd">@CachePut</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;redisCache&#34;</span><span class="p">,</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;key_user&#39;+#param.getParam().getId()&#34;</span><span class="p">,</span><span class="n">condition</span> <span class="o">=</span> <span class="s">&#34;#result != null&#34;</span><span class="p">)</span>
<span class="nd">@Transactional</span><span class="p">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="n">Isolation</span><span class="p">.</span><span class="na">REPEATABLE_READ</span><span class="p">,</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="p">.</span><span class="na">REQUIRES_NEW</span><span class="p">,</span><span class="n">rollbackFor</span> <span class="o">=</span> <span class="n">RuntimeException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="nf">Object</span> <span class="n">strategy</span><span class="p">(</span><span class="n">HandlerParam</span> <span class="nf">param</span><span class="p">)</span> <span class="kd">throws</span> <span class="nf">IOException</span> <span class="p">{</span>
        <span class="c1">//因为这里我写了两个接口，因此可以通过参数的类型判断调用哪个接口
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">Map</span><span class="p">){</span>
            <span class="c1">//获取要修改类型的参数
</span><span class="c1"></span>            <span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">map</span> <span class="o">=</span> <span class="p">(</span><span class="n">Map</span><span class="p">)</span><span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">();</span>
            <span class="n">users20174046Mapper</span><span class="p">.</span><span class="na">updateUsers</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;调用的是动态sql的接口&#34;</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">()</span> <span class="k">instanceof</span> <span class="n">Users20174046</span><span class="p">){</span>
            <span class="n">users20174046Mapper</span><span class="p">.</span><span class="na">updateByUsers</span><span class="p">((</span><span class="n">Users20174046</span><span class="p">)</span><span class="n">param</span><span class="p">.</span><span class="na">getParam</span><span class="p">());</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;调用的map接口&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;执行修改完成&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>    
  
<span class="cm">/*
</span><span class="cm">从代码中可以看到方法，可能返回null。如果为null，则不需要缓存数据，所以在注解＠CachePut中加入了condition  
</span><span class="cm">配置工页，它也是一个SpringEL表达式，这个表达式要求返回Boolean类型值，如果为仕ue，则使用缓存操作，否则就不使用。  
</span><span class="cm">这里的表达式为＃result！＝’null’，意味着如果返回null，则方法结束后不再操作缓存。同样地，＠Cacheable和  
</span><span class="cm">@CacheEvict也具备这个配置项。
</span><span class="cm">*/</span>
  </code></pre></div></li>
</ol>

<h2 id="2-3-cacheevict-清除缓存">2.3 @CacheEvict 清除缓存</h2>

<h4 id="该注解用于方法体上会清除与该方法体有关的缓存">该注解用于方法体上会清除与该方法体有关的缓存</h4>

<h1 id="3-在启动类上开启缓存">3 在启动类上开启缓存</h1>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * @author ZhangRongjun
</span><span class="cm"> * @EnableCaching ：开启缓存
</span><span class="cm"> */</span>
<span class="nd">@SpringBootApplication</span>
<span class="nd">@MapperScan</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&#34;com.fyzn12.mapper&#34;</span><span class="p">,</span><span class="n">annotationClass</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@EnableCaching</span>
<span class="kd">public</span> <span class="nf">class</span> <span class="n">SpringbootDemoApplication</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="nf">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="nf">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">SpringbootDemoApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
 </code></pre></div>
<h1 id="4-自调用使注解失效">4 自调用使注解失效</h1>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">  
<span class="c1">//获取id，取参数id缓存用户
</span><span class="c1"></span>    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="nd">@Cacheable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;redisCache&#34;</span><span class="p">,</span><span class="n">key</span> <span class="o">=</span><span class="s">&#34;&#39;redis_user_&#39;+#id&#34;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="nf">User</span> <span class="n">getUser</span> <span class="p">(</span><span class="n">Long</span> <span class="nf">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">userDao</span><span class="p">.</span><span class="na">getUser</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//更新数据后，更新缓存，如果condition配置项使结果返回为null，不缓存
</span><span class="c1"></span>    <span class="n">Override</span>
    <span class="nd">@Transactional</span>
    <span class="nd">@CachePut</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;redisCache&#34;</span> <span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s">&#34;#result == null &#34;</span><span class="p">,</span><span class="n">key</span> <span class="o">==</span><span class="s">&#34;&#39;redis_user_&#39;+＃id&#34;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="nf">User</span> <span class="n">updateUserName</span> <span class="p">(</span><span class="n">Long</span> <span class="nf">id</span><span class="p">,</span> <span class="n">String</span> <span class="nf">userName</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//此处调用getUser方法，该方法缓存注解失效，
</span><span class="c1"></span>        <span class="c1">// 所以这里还会执行SQL，将查询到数据库最新数据
</span><span class="c1"></span>        <span class="n">User</span> <span class="nf">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getUser</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">user</span><span class="p">.</span><span class="na">setUserName</span><span class="p">(</span><span class="n">userName</span><span class="p">);</span>
        <span class="n">userDao</span><span class="p">.</span><span class="na">updateUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="p">;</span> <span class="c1">//命中率低，所以不采用缓存机制
</span><span class="c1"></span>    <span class="p">}</span>  </code></pre></div><div class="highlight"><pre class="chroma">为什么会这样呢？其实在数据库事务中已经探讨过其原理，只要回顾一下就清楚了，那是因为Spring的缓存机制也是  
基于SpringAOP的原理，而在Spring中AOP是通过动态代理技术来实现的，这里的updateUserName方法调用getUser    
方法是类内部的自调用，并不存在代理对象的调用，这样便不会出现AOP，也就不会使用到标注在getUser上的缓存注解  
去获取缓存的值了，这是需要注意的地方。要克服这个问题，可以参考《数据库的事务》一文中关于数据库事务那样用两个  
服务(Service）类相互调用，或者直接从SpringIoC容器中获取代理对象来操作，这样就能成功克服自调用的问题了。</pre></div>
    </article>

    
    <div class="prevnext">
        



<ul class="prevnext">
    
    <li>上一篇：
        <a href="https://fyzn12.github.io/post/design_mode/observer/">
            观察者模式
        </a>
    </li>
    
    
    <li>下一篇：
        <a href="https://fyzn12.github.io/post/design_mode/decorator_design/">
            装饰者模式
        </a>
    </li>
    
</ul>

    </div>
    
    <div class="post-comments">
        
  
  

  
    <script src="https://utteranc.es/client.js"
            repo="fyzn12/Y4er.com"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </div>
</div>
            </div>
            
            <div class="col-second">
                <div class="col-box col-box-author">
    <img class="avatar" src="https://fyzn12.github.io/images/header.jpg" alt="fyzn12">
    <div class="col-box-title name">fyzn12</div>
    <p>哀吾生之须臾,羡长江之无穷.</p>
    <p class="contact">
        <a href="fyzn12_z@163.com">Email</a>
        <a href="https://fyzn12.github.io">Github</a>
    </p>
</div>

<div class="col-box">
    <div class="col-box-title">Newest Posts</div>
    <ul class="post-list">
        
        <li>
            <a href="https://fyzn12.github.io/about/" class="post-link">About</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/database/mysql/" class="post-link">Mysql基础底层</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/spring-boot/upload/" class="post-link">SpringBoot结合antd组件Upload实现文件上传</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/algorithm/%E5%AF%BB%E6%89%BE%E4%B8%AD%E4%BD%8D%E6%95%B0/" class="post-link">求两个有序数组的中位数</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/algorithm/tree/" class="post-link">二叉树</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/design_mode/command-design/" class="post-link">命令模式</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/algorithm/hashtable/" class="post-link">哈希检索</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/algorithm/linkedlist/" class="post-link">LinkedList以及栈的深度理解</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/design_mode/singleton/" class="post-link">单例模式</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/design_mode/factory-pattern/" class="post-link">工厂模式</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/design_mode/decorator_design/" class="post-link">装饰者模式</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/springboot%E6%95%B4%E5%90%88redis%E5%AE%9E%E7%8E%B0%E5%90%8C%E6%AD%A5%E7%BC%93%E5%AD%98/" class="post-link">SpringBoot整合Redis使用注解实现同步缓存</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/design_mode/observer/" class="post-link">观察者模式</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/database/transaction/" class="post-link">数据库的事务</a>
        </li>
        
        <li>
            <a href="https://fyzn12.github.io/post/spring-boot/springboot-information/" class="post-link">SpringBoot优点</a>
        </li>
        
    </ul>
</div>

<div class="col-box post-toc hide">
    <div class="col-box-title">TOC</div>
</div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="wrapper">
    © 2020    <a href="https://fyzn12.github.io/">fyzn12</a>
</div>
    </footer>
    
    
<script src="https://cdn.jsdelivr.net/npm/jquery@1.11.0/dist/jquery.min.js"></script>

<script src="/js/easybook.js"></script>

<script src="/js/lazysizes.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.12/dist/js/lightgallery-all.min.js"></script>
<script src="/js/figure.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-XXXXXXXX-X', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






</body>

</html>