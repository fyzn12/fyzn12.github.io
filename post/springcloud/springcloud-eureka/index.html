<!DOCTYPE html>
<html lang="en"><head>
    <title>首页</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://fyzn12.github.io/favicon.ico">
    <link rel="canonical" href="https://fyzn12.github.io">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://fyzn12.github.io">首页</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/post/">
                                    
                                    <span>All posts</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>SpringCloud之Eureka2.0服务注册中心 - Tue, Jul 21, 2020</h1>
    </div>
    <p class="lead">SpringCloud之Eureka2.0服务注册中心... ...</p>
    

<h1 id="springcloud之eureka2-0服务注册中心">SpringCloud之Eureka2.0服务注册中心</h1>

<hr />

<h1 id="1-了解相关概念">1 了解相关概念</h1>

<h2 id="1-1-微服务架构如何拆分">1.1 微服务架构如何拆分</h2>

<ol>
<li>微服务架构把每一个职责单一功能存放在独立的服务中<br /></li>
<li>每个服务运行在单独的进程中<br /></li>
<li>每个服务有自己独立数据库存储、实际上有自己独立的缓存、数据库、消息队列等<br />
<br /></li>
</ol>

<h2 id="1-2-微服务架构与soa架构区别">1.2 微服务架构与SOA架构区别</h2>

<ol>
<li>微服务架构基于SOA架构演变过来，继承SOA架构优点，在微服务架构中去除SOA架构中的ESB消息总线，采用http+json（restful）进行传输。<br /></li>
<li>微服务架构比SOA架构粒度会更加精细，让专业的人去做专业的事。<br /></li>
<li>SOA架构中可能数据存储会发生共享，微服务架构强调每个服务都是单独的数据库，保证每个服务与服务之间互不影响。<br />
<br /></li>
</ol>

<h2 id="1-3-一线简单的概念">1.3 一线简单的概念</h2>

<h3 id="1-3-1-服务治理">1.3.1 服务治理</h3>

<h4 id="服务治理-阿里巴巴开源的dubbo和当当网在基础上扩展的dubbox-eureka-apache的consul等">服务治理： 阿里巴巴开源的Dubbo和当当网在基础上扩展的Dubbox，Eureka，Apache的Consul等</h4>

<h3 id="1-3-2-服务注册与发现">1.3.2 服务注册与发现</h3>

<h4 id="rpc远程调用框架核心设计思想-在于注册中心-因为使用注册中心管理每个服务与服务之间的一个依赖关系-服务治理概念">RPC远程调用框架核心设计思想：在于注册中心，因为使用注册中心管理每个服务与服务之间的一个依赖关系（服务治理概念）</h4>

<ol>
<li>服务注册与服务发现原理，在任何的RPC远程调用框架中，都会有一个注册中心。<br /></li>
<li>注册中心的概念：存放服务地址相关信息（接口地址）</li>

<li><p>SpringCloud中支持一下三种注册中心</p>

<pre><code>Eureka  
Consul（go语言编写）  
Zookerper  
注意：Dubbo支持两种Redis和Zookeeper    
</code></pre></li>
</ol>

<div align=center><img src="https://fyzn12.github.io/img/picture/server-register.png"/></div>  

<ol>
<li>springcloud组件架构图<br />
<div align=center><img src="https://fyzn12.github.io/img/picture/springcloud-contructor.png"/></div><br />
<br /></li>
</ol>

<hr />

<h1 id="2-springcloud支持的三种注册中心详解">2 SpringCloud支持的三种注册中心详解</h1>

<h2 id="2-1-eureka注册中心环境搭建">2.1 Eureka注册中心环境搭建</h2>

<h3 id="2-1-1-配置基于单集群的环境">2.1.1 配置基于单集群的环境</h3>

<h4 id="1-配置pom文件">1. 配置pom文件</h4>

<pre><code>          &lt;parent&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
            &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;
          &lt;/parent&gt;
          &lt;groupId&gt;com.fyzn12&lt;/groupId&gt;
          &lt;artifactId&gt;springcloud-study-server&lt;/artifactId&gt;
          &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
          &lt;packaging&gt;jar&lt;/packaging&gt;

          &lt;name&gt;springcloud-study-server Maven Webapp&lt;/name&gt;
          &lt;!-- FIXME change it to the project's website --&gt;
          &lt;url&gt;http://www.example.com&lt;/url&gt;

          &lt;properties&gt;
            &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
            &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;
            &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;
            &lt;java.version&gt;1.8&lt;/java.version&gt;
          &lt;/properties&gt;

          &lt;dependencyManagement&gt;
            &lt;dependencies&gt;
              &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;Hoxton.SR2&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
              &lt;/dependency&gt;
            &lt;/dependencies&gt;
          &lt;/dependencyManagement&gt;

          &lt;dependencies&gt;
            &lt;!-- 导入springboot的启动器--&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
              &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;!-- 导入springcloud的启动器--&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;
            &lt;/dependency&gt;

            &lt;dependency&gt;
              &lt;groupId&gt;junit&lt;/groupId&gt;
              &lt;artifactId&gt;junit&lt;/artifactId&gt;
              &lt;version&gt;4.12&lt;/version&gt;
            &lt;/dependency&gt;

          &lt;/dependencies&gt;  
</code></pre>

<h5 id="注意-springcloud与springboot版本具有适配-a-href-https-spring-io-projects-spring-cloud-版本适配路径-a">注意：SpringCloud与SpringBoot版本具有适配<a href="https://spring.io/projects/spring-cloud">版本适配路径</a></h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/version.png"/></div>   
  

<h5 id="如上图打开版本适配链接-会开到如图所示的界面-往下面滑动会考到如图所示">如上图打开版本适配链接，会开到如图所示的界面，往下面滑动会考到如图所示</h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/version2.png"/></div>     
  

<h4 id="2-添加application-properties文件">2. 添加application.properties文件</h4>

<pre><code>            # 项目的端口号
            server.port=8100
            # 服务的注册中心ip
            eureka.instance.hostname=127.0.0.1
            # 当前服务注册到eureka服务地址
            eureka.client.service-url.defaultZone=http://${eureka.instance.hostname}:${server.port}/eureka/
            # 是否需要将服务注册到eureka注册中心上面，这里本身就是注册中心不需要（但是集群的时候需要为true）
            eureka.client.register-with-eureka=false
            # 是否需要检索服务
            eureka.client.fetch-registry=false
            # 运行出bug可添加
            spring.main.allow-bean-definition-overriding=true  
</code></pre>

<h4 id="3-编写注册中心服务的启动类">3. 编写注册中心服务的启动类</h4>

<pre><code>        /**
         * @author fyzn12
         * @version 1.0
         * @date 2020/7/20 18:55
         * @EnableEurekaServer：开启注册服务
         * @description:TODO
         */


        @SpringBootApplication
        @EnableEurekaServer
        public class AppEureka {
            public static void main(String[] args) {
                SpringApplication.run(AppEureka.class,args);
            }
        } 
</code></pre>

<h4 id="4-编写会员服务项目">4.编写会员服务项目</h4>

<ol>
<li>配置会员服务项目的pom文件（同上面pom文件配置，需要修改<artifactId>springcloud-study-server</artifactId>即可）<br /></li>

<li><p>添加application.properties文件</p>

<pre><code>    # 项目的端口号
    server.port=8000
    # 服务别名--服务注册到注册中心的名称
    spring.application.name=app-test-member
    # 当前服务注册到eureka服务地址，8100是注册中心服务端端口号
    eureka.client.service-url.defaultZone=http://localhost:8100/eureka
    # 需要将服务注册到eureka上面
    eureka.client.register-with-eureka=true
    # 是否需要检索服务
    eureka.client.fetch-registry=true  
</code></pre></li>

<li><p>编写会员服务启动类</p>

<pre><code>/**
 * @author fyzn12
 * @version 1.0
 * @date 2020/7/20 21:34
 * @description:TODO
 */
@SpringBootApplication
@EnableEurekaClient
public class AppTest {
    public static void main(String[] args) {
        SpringApplication.run(AppTest.class,args);
    }
}
</code></pre></li>

<li><p>编写访问接口MemberController</p>

<pre><code>/**
 * @author fyzn12
 * @version 1.0
 * @date 2020/7/20 22:57
 * @description:TODO
 */
@RestController
public class MemberController {
    @Value(&quot;${server.port}&quot;)
    String port;
    @RequestMapping(&quot;/getMember&quot;)
    public String getMember(){
        return &quot;this is a member 我是会员服务，端口号：&quot;+port;
    }
}  
</code></pre></li>
</ol>

<h4 id="5-编写订单服务项目">5.编写订单服务项目</h4>

<ol>
<li>配置会员服务项目的pom文件（同上面pom文件配置，需要修改<artifactId>springcloud-study-server</artifactId>即可）<br /></li>

<li><p>添加application.properties文件</p>

<pre><code>    # 项目的端口号
    server.port=8001
    # 服务别名--服务注册到注册中心的名称
    spring.application.name=app-test-order
    # 当前服务注册到eureka服务地址
    eureka.client.service-url.defaultZone=http://localhost:8100/eureka
    # 需要将服务注册到eureka上面
    eureka.client.register-with-eureka=true
    # 是否需要检索服务
    eureka.client.fetch-registry=true
    spring.main.allow-bean-definition-overriding=true    
</code></pre></li>

<li><p>编写订单服务启动类</p>

<pre><code>    /**
     * @author fyzn12
     * @version 1.0
     * @date 2020/7/21 9:03
     * @description:TODO
     */
    @SpringBootApplication
    @EnableEurekaClient
    public class AppOrder {
        public static void main(String[] args) {
            SpringApplication.run(AppOrder.class,args);
        }
        /**
         * 解决RestTemplate未能加入到Spring容器中，不能通过注解@Autowired获取bean
         *@LoadBalanced:该注解能让RestTemplate拥有负载均衡的能力
         * */
        @Bean
        @LoadBalanced
        public RestTemplate restTemplate(){
            return new RestTemplate();
        }

    }  
</code></pre></li>

<li><p>编写访问接口OrderController</p>

<pre><code>/**
 * @author fyzn12
 * @version 1.0
 * @date 2020/7/21 9:09
 * @description:TODO
 */
@RestController
public class OrderController {
    /**
     * RestTemplate是SpringBoot Web组件提供默认整合ribbon负载均衡器
     * rest方式
     *
     * */
    @Value(&quot;${server.port}&quot;)
    String port;
    @Autowired
    private RestTemplate restTemplate;
    @RequestMapping(&quot;/getOrder&quot;)
    public String getOrder(){
        String url = &quot;http://app-test-member/getMember&quot;;
        String result = &quot;我是订单服务获取会员服务信息：&quot;+restTemplate.getForObject(url, String.class);
        System.out.println(&quot;订单服务result:&quot;+result);
        return result;
    }
}
</code></pre></li>
</ol>

<h4 id="6-测试">6.测试</h4>

<div align=center><img src="https://fyzn12.github.io/img/picture/springcloud-test.png"/></div>     
  

<h3 id="2-1-2-配置基于集群的环境">2.1.2 配置基于集群的环境</h3>

<h4 id="1-客户端集群">1. 客户端集群</h4>

<h5 id="1-添加一个member2项目-该项目于member只有application-properties文件中的端口号不同-其余都相同-这里只是模拟">(1) 添加一个member2项目，该项目于member只有application.properties文件中的端口号不同，其余都相同（这里只是模拟）</h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/member2.png"/></div>    
  

<h5 id="2-运行订单项目-访问getorder地址-查看端口号-测试访问的是那个端口在执行">(2)运行订单项目，访问getOrder地址，查看端口号，测试访问的是那个端口在执行</h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/member3.png"/></div>     
  

<h5 id="3-项目中使用-loadbalanced让resttemplate拥有负载均衡的能力-默认采用轮训的方式去获取客户端">(3) 项目中使用@LoadBalanced让RestTemplate拥有负载均衡的能力，默认采用轮训的方式去获取客户端。</h5>

<h4 id="2-注册中心集群测试">2. 注册中心集群测试</h4>

<h5 id="1-创建一个项目为springcloud-study-server2">(1)创建一个项目为springcloud-study-server2</h5>

<h5 id="2-更改application-properties文件">(2)更改application.properties文件</h5>

<pre><code>    springcloud-study-server的application.properties文件如下  

        # 项目的端口号
        server.port=9100
        # 服务的注册中心ip
        eureka.instance.hostname=127.0.0.1
        # 服务别名--服务注册到注册中心的名称
        spring.application.name=app-test-server
        # 当前服务注册到eureka服务地址
        eureka.client.service-url.defaultZone=http://${eureka.instance.hostname}:8100/eureka/
        # 是否需要将服务注册到eureka注册中心上面，这里本身就是注册中心不需要（但是集群的时候需要为true）
        eureka.client.register-with-eureka=true
        # 是否需要检索服务
        eureka.client.fetch-registry=true
        spring.main.allow-bean-definition-overriding=true   



    springcloud-study-server2的application.properties文件如下   

        # 项目的端口号
        server.port=8100
        # 服务的注册中心ip
        eureka.instance.hostname=127.0.0.1
        # 服务别名--服务注册到注册中心的名称
        spring.application.name=app-test-server
        # 当前服务注册到eureka服务地址
        eureka.client.service-url.defaultZone=http://${eureka.instance.hostname}:9100/eureka/
        # 是否需要将服务注册到eureka注册中心上面，这里本身就是注册中心不需要（但是集群的时候需要为true）
        eureka.client.register-with-eureka=true
        # 是否需要检索服务
        eureka.client.fetch-registry=true
        spring.main.allow-bean-definition-overriding=true  
</code></pre>

<h5 id="3-启动所有项目">(3)启动所有项目</h5>

<h5 id="4-故意停掉springcloud-study-server项目-再次测试">(4)故意停掉springcloud-study-server项目，再次测试</h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/server-test2.png"/></div>    
  

<h5 id="刷新http-localhost-9100-页面之后-大约30秒之后-原来处于http-localhost-8100-注册中心的地址-也刷新到http-localhost-9100-注册中心服务集群测试成功">刷新<a href="http://localhost:9100/页面之后，大约30秒之后，原来处于http://localhost:8100/注册中心的地址，也刷新到http://localhost:9100/，注册中心服务集群测试成功">http://localhost:9100/页面之后，大约30秒之后，原来处于http://localhost:8100/注册中心的地址，也刷新到http://localhost:9100/，注册中心服务集群测试成功</a></h5>

<h3 id="2-1-2-ribbon和nginx的区别">2.1.2 Ribbon和Nginx的区别</h3>

<div align=center><img src="https://fyzn12.github.io/img/picture/ribbon.png"/></div>     
  

<h3 id="2-1-3-服务的雪崩效应">2.1.3 服务的雪崩效应</h3>

<div align=center><img src="https://fyzn12.github.io/img/picture/服务的雪崩效应.png"/></div>     

<h3 id="2-1-4-服务的隔离">2.1.4 服务的隔离</h3>

<div align=center><img src="https://fyzn12.github.io/img/picture/服务隔离.png"/></div>   

    <h4><a href="https://fyzn12.github.io">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>

    <a href="https://fyzn12.github.io">fyzn12</a> | 

&copy; 
<a href="https://fyzn12.github.io" target="_blank">
    fyzn12
</a>
<span id="thisyear">2020</span>

    | @


        | Built on <a href="//gohugo.io" target="_blank">Hugo</a>
</p>
    <p class="text-center">
        <a href="https://facebook.com">Facebook</a> 
        <a href="https://twitter.com">Twitter</a> 
        <a href="https://linkedin.com">Linkedin</a> 
        <a href="https://github.com">GitHub</a> 
        <a href="https://gitlab.com">GitLab</a>
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: false ,
        onePass: false , 
        speedFactor: 1 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
