<!DOCTYPE html>
<html lang="en"><head>
    <title>首页</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://fyzn12.github.io/favicon.ico">
    <link rel="canonical" href="https://fyzn12.github.io">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://fyzn12.github.io">首页</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/post/">
                                    
                                    <span>All posts</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>SpringCloud整合Consul注册中心 - Wed, Jun 24, 2020</h1>
    </div>
    <p class="lead">SpringCloud整合Consul注册中心... ...</p>
    

<h1 id="springcloud整合consul注册中心">SpringCloud整合Consul注册中心</h1>

<h1 id="1-consul简介">1 Consul简介</h1>

<h4 id="consul-是-hashicorp-公司推出的开源工具-用于实现分布式系统的服务发现与配置-与其他分布式服务注册与发现的方案-consul的方案更-一站式-内置了服务注册与发现框-架-具有以下性质">Consul 是 HashiCorp 公司推出的开源工具，用于实现分布式系统的服务发现与配置。与其他分布式服务注册与发现的方案，Consul的方案更“一站式”，内置了服务注册与发现框 架、具有以下性质：</h4>

<pre><code>            分布一致性协议实现、
            健康检查、
            Key/Value存储、
            多数据中心方案，
            不再需要依赖其他工具（比如ZooKeeper等）。
</code></pre>

<hr />

<h1 id="2-springcloud整合consul">2 SpringCloud整合Consul</h1>

<h2 id="2-1-创建会员服务">2.1 创建会员服务</h2>

<h3 id="2-1-1-配置会员服务的pom文件">2.1.1 配置会员服务的pom文件</h3>

<pre><code>     &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;
      &lt;/parent&gt;
      &lt;groupId&gt;com.fyzn12&lt;/groupId&gt;
      &lt;artifactId&gt;springcloud-consul-member&lt;/artifactId&gt;
      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
      &lt;packaging&gt;war&lt;/packaging&gt;

      &lt;name&gt;springcloud-consul-member Maven Webapp&lt;/name&gt;
      &lt;!-- FIXME change it to the project's website --&gt;
      &lt;url&gt;http://www.example.com&lt;/url&gt;

      &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;
      &lt;/properties&gt;

      &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
          &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
            &lt;version&gt;Hoxton.SR2&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
          &lt;/dependency&gt;
        &lt;/dependencies&gt;
      &lt;/dependencyManagement&gt;
      &lt;dependencies&gt;
        &lt;!-- 导入springboot的启动器--&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
          &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- 导入springcloud整合Zookeeper启动器--&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
          &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
          &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;junit&lt;/groupId&gt;
          &lt;artifactId&gt;junit&lt;/artifactId&gt;
          &lt;version&gt;4.12&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;


    这里注意一个bug，在最后会认真分析我在创建该项目过程中遇到的bug  
</code></pre>

<h3 id="2-1-2-创建application-yml文件">2.1.2 创建application.yml文件</h3>

<pre><code>        server:
          port: 8000
        spring:
          application:
            name: cs-member
          cloud:
            consul:
              host: localhost
              # 注册中心的端口号
              port: 8500
              discovery:
                hostname: 192.168.1.105
        cs-member:
          ribbon:
            listOfServers: http://localhost:8100  
</code></pre>

<h3 id="2-1-3-创建访问接口">2.1.3 创建访问接口</h3>

<pre><code>        /**
         * @author fyzn12
         * @version 1.0
         * @date 2020/7/26 22:16
         * @description:TODO
         */
        @RestController
        public class MemberController {
            @Value(&quot;${server.port}&quot;)
            private String port;
            @RequestMapping(value = &quot;/getConsulMember&quot;)
            public String getConsulMember(){
                return &quot;this is consul member，端口号：&quot;+port;
            }
        }   
</code></pre>

<h3 id="2-1-4-创建启动类">2.1.4 创建启动类</h3>

<pre><code>        /**
         * @author fyzn12
         * @version 1.0
         * @date 2020/7/26 22:10
         * @description:TODO
         */
        @SpringBootApplication
        @EnableDiscoveryClient
        public class AppConsulMember {
            public static void main(String[] args) {
                SpringApplication.run(AppConsulMember.class,args);
            }
        }  
</code></pre>

<h2 id="2-2-创建订单服务">2.2 创建订单服务</h2>

<h3 id="2-2-1-配置会员服务的pom文件">2.2.1 配置会员服务的pom文件</h3>

<pre><code>         &lt;parent&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
            &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;
          &lt;/parent&gt;
          &lt;groupId&gt;com.fyzn12&lt;/groupId&gt;
          &lt;artifactId&gt;springcloud-consul-order&lt;/artifactId&gt;
          &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
          &lt;packaging&gt;war&lt;/packaging&gt;

          &lt;name&gt;springcloud-consul-order Maven Webapp&lt;/name&gt;
          &lt;!-- FIXME change it to the project's website --&gt;
          &lt;url&gt;http://www.example.com&lt;/url&gt;

          &lt;properties&gt;
            &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
            &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;
            &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;
          &lt;/properties&gt;

          &lt;dependencyManagement&gt;
            &lt;dependencies&gt;
              &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;Hoxton.SR2&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
              &lt;/dependency&gt;
            &lt;/dependencies&gt;
          &lt;/dependencyManagement&gt;
          &lt;dependencies&gt;
            &lt;!-- 导入springboot的启动器--&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
              &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;!-- 导入springcloud整合feign客户端启动器--&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;!-- 导入springcloud整合Zookeeper启动器--&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
              &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;junit&lt;/groupId&gt;
              &lt;artifactId&gt;junit&lt;/artifactId&gt;
              &lt;version&gt;4.12&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
              &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
            &lt;/dependency&gt;
          &lt;/dependencies&gt;  
</code></pre>

<h3 id="2-2-2-创建订单服务application-yml文件">2.2.2 创建订单服务application.yml文件</h3>

<pre><code>        server:
          port: 8100
        spring:
          application:
            name: cs-order
          cloud:
            consul:
              host: 127.0.0.1
              port: 8500
              discovery:
                hostname: 192.168.1.105
        cs-member:
          ribbon:
            listOfServers: http://localhost:8100  
</code></pre>

<h3 id="2-2-3-创建feign客户端调用接口">2.2.3 创建feign客户端调用接口</h3>

<pre><code>        /**
         * @author fyzn12
         * @version 1.0
         * @date 2020/7/26 22:24
         * @description:TODO
         */
        @FeignClient(&quot;cs-member&quot;)
        public interface ConsulOrderFeign {
            @RequestMapping(&quot;/getConsulMember&quot;)
            String getConsulMember();
        }    
</code></pre>

<h3 id="2-2-4-创建启动类">2.2.4 创建启动类</h3>

<pre><code>        /**
         * @author fyzn12
         * @version 1.0
         * @date 2020/7/26 22:24
         * @description:TODO
         */
        @SpringBootApplication
        @EnableDiscoveryClient
        @EnableFeignClients
        public class AppConsulOrder {
            public static void main(String[] args) {
                SpringApplication.run(AppConsulOrder.class,args);
            }

        }  
</code></pre>

<h3 id="2-2-5-创建访问接口">2.2.5 创建访问接口</h3>

<pre><code>        /**
         * @author fyzn12
         * @version 1.0
         * @date 2020/7/26 22:26
         * @description:TODO
         */
        @RestController
        public class ConsulOrderController {
            @Autowired
            private ConsulOrderFeign consulOrderFeign;
            @RequestMapping(value = &quot;/getConsulOrder&quot;)
            public String getConsulOrder(){
                return consulOrderFeign.getConsulMember();
            }
        }  
</code></pre>

<h2 id="2-3-启动会员服务和订单服务-访问http-localhost-8500查看服务是否注册到consul上">2.3 启动会员服务和订单服务，访问http:localhost:8500查看服务是否注册到consul上</h2>

<div align=center><img src="https://fyzn12.github.io/img/picture/consul.png"/></div>   
   

<h2 id="2-4-访问测试">2.4 访问测试</h2>

<div align=center><img src="https://fyzn12.github.io/img/picture/consul-test.png"/></div>    
  

<h2 id="2-5-总结">2.5 总结</h2>

<h4 id="通过访问订单服务的路径-读取出会员服务的数据-说明使用feign客户端调用成功-整合consul注册中心成功">通过访问订单服务的路径，读取出会员服务的数据，说明使用feign客户端调用成功，整合Consul注册中心成功。</h4>

<hr />

<h1 id="3-在整合过程中遇到的bug与解决方法">3 在整合过程中遇到的bug与解决方法</h1>

<h2 id="3-1-bug出现的错误提示">3.1 bug出现的错误提示</h2>

<h3 id="3-1-1-首先查看consul注册中心提示">3.1.1 首先查看consul注册中心提示</h3>

<div align=center><img src="https://fyzn12.github.io/img/picture/consul-bug1.png"/></div>   
  

<h5 id="如图上面在consul注册中心上面可以看到提示会员服务和订单服务都以注册到上面-但是存在错误接下来点击会员服务查看在注册中心上面的错误提示">如图上面在consul注册中心上面可以看到提示会员服务和订单服务都以注册到上面，但是存在错误接下来点击会员服务查看在注册中心上面的错误提示</h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/consul-bug2.png"/></div>     
  

<h5 id="如图上面提示可以看出-对于会员服务和订单服务的output可以很明显的看出-对于顶大服务报http-get-http-192-168-1-105-8100-actuator-health-404-造成这个问题的很大一种原因就是没有引入actuator的依赖-导致该路径找不到">如图上面提示可以看出，对于会员服务和订单服务的output可以很明显的看出，对于顶大服务报HTTP GET <a href="http://192.168.1.105:8100/actuator/health:">http://192.168.1.105:8100/actuator/health:</a> 404，造成这个问题的很大一种原因就是没有引入actuator的依赖，导致该路径找不到</h5>

<h3 id="3-1-2-访问订单服务查看错误提示">3.1.2 访问订单服务查看错误提示</h3>

<div align=center><img src="https://fyzn12.github.io/img/picture/consul-bug3.png"/></div> 
  

<h5 id="对于错误load-balancer-does-not-have-available-server-for-client-cs-member造成的原因有很多如下是可能会造成这个错误的原因部分列举">对于错误Load balancer does not have available server for client: cs-member造成的原因有很多如下是可能会造成这个错误的原因部分列举</h5>

<ol>
<li>在创建feign客户端调用的接口时，@FeignClient内给定的名称与会员服务的别名不相同<br /></li>
<li>会员服务可能没哟给定别名<br /></li>
</ol>

<h5 id="对于上面我知道的这两种原因显然都不是-因此引入actuator的依赖">对于上面我知道的这两种原因显然都不是，因此引入actuator的依赖</h5>

<pre><code>        &lt;dependency&gt;
          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
          &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;  
</code></pre>

<h5 id="在会员服务和订单服务上面引入上面的依赖再次查看consul的注册中心发现错误提示消失">在会员服务和订单服务上面引入上面的依赖再次查看consul的注册中心发现错误提示消失</h5>

<div align=center><img src="https://fyzn12.github.io/img/picture/consul-bug5.png"/></div>      
  

<h5 id="访问订单服务的路径正常显示信息-bug解决">访问订单服务的路径正常显示信息，bug解决</h5>

    <h4><a href="https://fyzn12.github.io">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>

    <a href="https://fyzn12.github.io">fyzn12</a> | 

&copy; 
<a href="https://fyzn12.github.io" target="_blank">
    fyzn12
</a>
<span id="thisyear">2020</span>

    | @


        | Built on <a href="//gohugo.io" target="_blank">Hugo</a>
</p>
    <p class="text-center">
        <a href="https://facebook.com">Facebook</a> 
        <a href="https://twitter.com">Twitter</a> 
        <a href="https://linkedin.com">Linkedin</a> 
        <a href="https://github.com">GitHub</a> 
        <a href="https://gitlab.com">GitLab</a>
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: false ,
        onePass: false , 
        speedFactor: 1 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
